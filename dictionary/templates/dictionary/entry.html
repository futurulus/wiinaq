{% extends "dictionary/base.html" %}

{% block content %}
<div class="listing">
    <h1>{{ word }}</h1>

    {% for root in roots %}
    {% if root.pos %}
    <p class="root-header"><span class="pos">{{ root.pos }}</span>
    <span class="root-label">root:</span> <span class="root">{{ root.root }}-</span></p>
    {% endif %}

    <ol>
    {% for sense in root.senses %}
        <li class="listing-defn"><span class="defn">{{ sense.defn }}</span>
            <span class="sources">{{ sense.sources|join:"; " }}</span>
            </li>
    {% endfor %}
    </ol>


    {% if root.inflections %}
    <div class="popout" id="endings-{{ root.id }}">

        <h2 class="popout-header">Endings</h2>

        <div class="popout-content">
            {% for table in root.inflections %}
            <h3>{{ table.title }}</h3>
            <table class="inflection" id="{{ table.id }}">
                <tr>
                    <th />
                    {% for h in table.column_headers %}
                    <th>{{ h }}</th>
                    {% endfor %}
                </tr>
                {% for r in table.rows %}
                <tr>
                    <th>{{ r.header }}</th>
                    {% for c in r.cells %}
                    <td class="inflection-entry" id="{{ c.id }}">
                        {% for id, entry in c.map.items %}
                        <span class="inflection-option hide" id="{{ id }}">{{ entry }}</span>
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>

            <script>
            </script>
            {% endfor %}

            <p class="disclaimer">(Endings are automatically generated. Help us out by
            <a href="https://docs.google.com/forms/d/1mxloJwG76jL7Y8ACQaAI-w25fe09vn_CBShexOXr-wQ/viewform?entry.252901238=Incorrect+word+or+ending&entry.599026928={{ url|urlencode }}&entry.1210689804={{ request.META.HTTP_USER_AGENT|urlencode }}">reporting errors!</a>)</p>
            <!--<a href="https://docs.google.com/forms/d/1mxloJwG76jL7Y8ACQaAI-w25fe09vn_CBShexOXr-wQ/viewform?entry.252901238=Incorrect+word+or+ending&entry.1210689804=BROWSER&entry.923122775=OPERATING_SYSTEM&entry.599026928=URL&entry.1930047016=PROBLEM&entry.2005487674=CONTACT">-->
        </div>
    </div>
    <script>
        var state = new PopoutState($(endings.escape_id("endings-{{ root.id }}")));

        {% for table in root.inflections %}
        // {
            state.row_span["{{ table.id }}"] = {
            {% for cell_id, conditions in table.row_span.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };

            state.col_span["{{ table.id }}"] = {
            {% for cell_id, conditions in table.col_span.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };

            state.collapse["{{ table.id }}"] = {
            {% for cell_id, conditions in table.collapse.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };
        // }
        {% endfor %}

        endings.state["endings-{{ root.id }}"] = state;

        {% for table in root.inflections %}
        state.activate_cell("{{ table.default }}");
        {% endfor %}
    </script>
    {% endif %}
    {% endfor %}
</div>
{% endblock %}
