{% extends "dictionary/base.html" %}

{% block content %}
<div class="listing">
    <h1>{{ word }}</h1>

    {% for chunk in chunks %}
    <p class="listing-defn"><span class="pos">{{ chunk.chunk.pos }}</span> {{ chunk.chunk.defn }}</p>

    <p class="sources">Source: <span class="source">{{ chunk.chunk.source }}</span></p>

    {% if chunk.inflections %}
    <div class="popout" id="endings-{{ chunk.chunk.id }}">

        <h2 class="popout-header">Endings</h2>

        <div class="popout-content">
            {% for table in chunk.inflections %}
            <h3>{{ table.title }}</h3>
            <table class="inflection" id="{{ table.id }}">
                <tr>
                    <th />
                    {% for h in table.column_headers %}
                    <th>{{ h }}</th>
                    {% endfor %}
                </tr>
                {% for r in table.rows %}
                <tr>
                    <th>{{ r.header }}</th>
                    {% for c in r.cells %}
                    <td class="inflection-entry" id="{{ c.id }}">
                        {% for id, entry in c.map.items %}
                        <span class="inflection-option hide" id="{{ id }}">{{ entry }}</span>
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>

            <script>
            </script>
            {% endfor %}

            <p class="disclaimer">(Endings are automatically generated. Help us out by reporting
            errors!)</p>
        </div>
    </div>
    <script>
        var state = new PopoutState($(endings.escape_id("endings-{{ chunk.chunk.id }}")));

        {% for table in chunk.inflections %}
        // {
            state.row_span["{{ table.id }}"] = {
            {% for cell_id, conditions in table.row_span.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };

            state.col_span["{{ table.id }}"] = {
            {% for cell_id, conditions in table.col_span.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };

            state.collapse["{{ table.id }}"] = {
            {% for cell_id, conditions in table.collapse.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };
        // }
        {% endfor %}

        endings.state["endings-{{ chunk.chunk.id }}"] = state;

        {% for table in chunk.inflections %}
        state.activate_cell("{{ table.default }}");
        {% endfor %}
    </script>
    {% endif %}
    {% endfor %}
</div>
{% endblock %}
