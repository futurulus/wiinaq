{% extends "dictionary/base.html" %}

{% block content %}
<div class="listing">
    <h1>{{ word }}</h1>

    {% for root in roots %}
    <p class="root-header"><span class="pos">{{ root.pos }}</span>
    <span class="root-label">root:</span> <span class="root">{{ root.root }}-</span></p>

    <ol>
    {% for sense in root.senses %}
        <li class="listing-defn"><span class="defn">{{ sense.defn }}</span>
            <span class="sources">{{ sense.sources|join:"; " }}</span>
            </li>
    {% endfor %}
    </ol>


    {% if root.inflections %}
    <div class="popout" id="endings-{{ root.pos }}-{{ root.root }}">

        <h2 class="popout-header">Endings</h2>

        <div class="popout-content">
            {% for table in root.inflections %}
            <h3>{{ table.title }}</h3>
            <table class="inflection" id="{{ table.id }}">
                <tr>
                    <th />
                    {% for h in table.column_headers %}
                    <th>{{ h }}</th>
                    {% endfor %}
                </tr>
                {% for r in table.rows %}
                <tr>
                    <th>{{ r.header }}</th>
                    {% for c in r.cells %}
                    <td class="inflection-entry" id="{{ c.id }}">
                        {% for id, entry in c.map.items %}
                        <span class="inflection-option hide" id="{{ id }}">{{ entry }}</span>
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>

            <script>
            </script>
            {% endfor %}

            <p class="disclaimer">(Endings are automatically generated. Help us out by reporting
            errors!)</p>
        </div>
    </div>
    <script>
        var state = new PopoutState($(endings.escape_id("endings-{{ root.pos }}-{{ root.root }}")));

        {% for table in root.inflections %}
        // {
            state.row_span["{{ table.id }}"] = {
            {% for cell_id, conditions in table.row_span.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };

            state.col_span["{{ table.id }}"] = {
            {% for cell_id, conditions in table.col_span.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };

            state.collapse["{{ table.id }}"] = {
            {% for cell_id, conditions in table.collapse.items %}
                "{{ cell_id }}": "{{ conditions }}",
            {% endfor %}
            };
        // }
        {% endfor %}

        endings.state["endings-{{ root.pos }}-{{ root.root }}"] = state;

        {% for table in root.inflections %}
        state.activate_cell("{{ table.default }}");
        {% endfor %}
    </script>
    {% endif %}
    {% endfor %}
</div>
{% endblock %}
